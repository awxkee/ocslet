/*
 * // Copyright (c) Radzivon Bartoshyk 10/2025. All rights reserved.
 * //
 * // Redistribution and use in source and binary forms, with or without modification,
 * // are permitted provided that the following conditions are met:
 * //
 * // 1.  Redistributions of source code must retain the above copyright notice, this
 * // list of conditions and the following disclaimer.
 * //
 * // 2.  Redistributions in binary form must reproduce the above copyright notice,
 * // this list of conditions and the following disclaimer in the documentation
 * // and/or other materials provided with the distribution.
 * //
 * // 3.  Neither the name of the copyright holder nor the names of its
 * // contributors may be used to endorse or promote products derived from
 * // this software without specific prior written permission.
 * //
 * // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * // AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * // IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * // DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * // FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * // DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * // SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * // CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * // OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
use crate::WaveletFilterProvider;
use num_traits::AsPrimitive;
use std::borrow::Cow;

/// Represents the Coiflet wavelet family.
///
/// Each variant corresponds to a specific Coiflet wavelet with a different number
/// of vanishing moments. Coiflets are wavelets designed to have both the scaling
/// function and wavelet function with vanishing moments, providing better
/// approximation properties than standard Daubechies wavelets for certain signals.
#[derive(Copy, Clone, Debug, Ord, PartialOrd, Eq, PartialEq, Hash)]
pub enum CoifletFamily {
    /// Coiflet wavelet with 1 vanishing moment
    Coif1,
    /// Coiflet wavelet with 2 vanishing moments
    Coif2,
    /// Coiflet wavelet with 3 vanishing moments
    Coif3,
    /// Coiflet wavelet with 4 vanishing moments
    Coif4,
    /// Coiflet wavelet with 5 vanishing moments
    Coif5,
    /// Coiflet wavelet with 6 vanishing moments
    Coif6,
}

impl CoifletFamily {
    pub(crate) fn get_wavelet_impl(self) -> &'static [f64] {
        match self {
            CoifletFamily::Coif1 => [
                -5.142972847076845595317549230122688830344559947132656813651045e-02,
                2.389297284707684559531754923012268883034455994713265681365104e-01,
                6.028594569415369119063509846024537766068911989426531362730209e-01,
                2.721405430584630880936490153975462233931088010573468637269790e-01,
                -5.142972847076845595317549230122688830344559947132656813651045e-02,
                -1.107027152923154404682450769877311169655440052867343186348954e-02,
            ]
            .as_slice(),
            CoifletFamily::Coif2 => [
                1.158759673871686817889714882853120395708315073355502818875931e-02,
                -2.932013798346856448679594524397843054053420947418409889774786e-02,
                -4.763959031100813225872995081511549408622753909592460525840745e-02,
                2.730210465347666137982239328923516270034828327990699588033501e-01,
                5.746823938568638472459483149751499367740786490481481391460366e-01,
                2.948671936956191896750637208703777973914107635455611537640778e-01,
                -5.408560709171142997443672832006888537570221990444706777525838e-02,
                -4.202648046077160694657530752545884878978719268926222513485613e-02,
                1.674441016327950635146257083249391698866289538037299820224006e-02,
                3.967883612962012109043447090269950094081810916481648252817197e-03,
                -1.289203356140659543141355500990678257894936161704492503370186e-03,
                -5.095053991076441489598480835620951586540050976664367876412655e-04,
            ]
            .as_slice(),
            CoifletFamily::Coif3 => [
                -2.682418670922068664584689955153722375535836177157637134187840e-03,
                5.503126707831385107969640263617469178794666057252906037981936e-03,
                1.658356047917034608134280439996549525220639437145367606178002e-02,
                -4.650776447872697640390293095170192691113917841041002855534619e-02,
                -4.322076356021191118175840907244577856782537221435748296465882e-02,
                2.865033352736474630249006862976158896891076238443844211133873e-01,
                5.612852568703300445990941995240077241406247774064453800050914e-01,
                3.029835717728241602862575774374668529867757043461413348549577e-01,
                -5.077014075488886159516471867138370972545857441670871832472707e-02,
                -5.819625076158553022607041679522801089624825903982541419721721e-02,
                2.443409432116695639462954438418928805487699080947974989338820e-02,
                1.122924096203786563399489540091488781245346096838814728167341e-02,
                -6.369601011048822977293753932627342482077585617391852852955559e-03,
                -1.820458915566242322836631665832145136570132777862391313328351e-03,
                7.902051009575939937150950543290226440287715441826917281929124e-04,
                3.296651737931830308416338897758022998655744276957481989605186e-04,
                -5.019277455327664998007173088097694083956570594580641192332170e-05,
                -2.446573425530813115445387662881902303945941576472342106918209e-05,
            ]
            .as_slice(),
            CoifletFamily::Coif4 => [
                6.309612114309468490753696608619526520153127603444406835368201e-04,
                -1.152225143769973488683007937016166047881572156705066038094891e-03,
                -5.194525163470323267558201363327294331811309729430512113592118e-03,
                1.136246148326482276463392678363118465908960082105224676102131e-02,
                1.886723856956305960822813160712701905823879297781452350370094e-02,
                -5.746424190192718517290527411385172124443396690932404284859269e-02,
                -3.965265296244913762718094206756579981738035770770645437919302e-02,
                2.936674050161006858761278962798582650835466243678172528509866e-01,
                5.531264550395492870333469741987846570947502710783248169642137e-01,
                3.071573096678856987248881030393884808414165269795297009902001e-01,
                -4.711273752389572084912399351781012121935994396763702238263689e-02,
                -6.803811467802056988332974920928626798429778679560269769187728e-02,
                2.781363695846951303169163645831936314699164412528991864702607e-02,
                1.773583142270308388403079552822372238681544967313003044695583e-02,
                -1.075631615508724933047071603601897536695959225169888787867102e-02,
                -4.001010844950535391911552472397083276670126595827549403173754e-03,
                2.652664913530499860820143301690017184933302935238430721089152e-03,
                8.955939276952843603555618778866181384528643960440369133096025e-04,
                -4.165001950941708741516836418852536615951250588002878691463468e-04,
                -1.838296167136253805617482342622910940008368723403836355183423e-04,
                4.408022661597206973006038672236031501663774161685451815597956e-05,
                2.208284691230832960893331999804142845136324572860276715790883e-05,
                -2.304919162676504406778986897925054839632903355820414483306851e-06,
                -1.262179179994622253884862172782890488140153502131112374520603e-06,
            ]
            .as_slice(),
            CoifletFamily::Coif5 => [
                -1.499645228345950331670593167919531667975440598691604525531231e-04,
                2.535527523580334712936363872191554706055603482812691726895588e-04,
                1.540286725995222360335148244676269541414659303531250711822333e-03,
                -2.941078164035693185044038586065593320891475311414770624555173e-03,
                -7.164112349410053294382279572472252500899544810929605832362178e-03,
                1.655218330649288840540841623080651353621667424921282557975513e-02,
                1.991901719798432056056857854066125809443504706772520641876273e-02,
                -6.499837825472324963374262221660858232544804226063450042795603e-02,
                -3.680255347446873527191823500872992242220223547780834450868002e-02,
                2.980959014587191795511466861338063554509597132272839414668911e-01,
                5.475082713540367154128337935687830970431964302909253422329131e-01,
                3.097002590784203529311533316221254677074498876376965941549923e-01,
                -4.386731482823615640442730013366750193381707273908757638050452e-02,
                -7.464442013283971243472663968192859562973186442054433655531762e-02,
                2.919469277528073666095772398605275751022315529465178441510318e-02,
                2.310457227706684192610065243663928370022983285246219996141160e-02,
                -1.397129268638200558584119246355879336305763752871371182932059e-02,
                -6.476749751505861835547590642967453082384538848552165075614441e-03,
                4.781116799130657606400088024549264921093190305150784065791191e-03,
                1.719383484385504023022397097446276782318002683055773803854075e-03,
                -1.174947934413537690027670037110105795928147523549002426409332e-03,
                -4.508222400696236312231932151038336110220594834213702970043431e-04,
                2.134457975086291667348984871136041914777578046177470626552867e-04,
                9.924691139873533169989496559631669037970741600337089424730635e-05,
                -2.914684388622130824599478843558087403539428940986384077972155e-05,
                -1.504031798197685905639227292876711236513927746903476131955063e-05,
                2.616809660013118152124234488302931243021794024318439103773996e-06,
                1.457502921355163070577152619048168436286350537937563166257584e-06,
                -1.148199649902979726237655584441763456854312591680755421569962e-07,
                -6.791060677322355511541065559242475254516249773485524025251102e-08,
            ]
            .as_slice(),
            CoifletFamily::Coif6 => [
                3.590369176713147297619137585162985487882983106558813483919654e-05,
                -5.739587600308579302553116112640931312834124316491419262693257e-05,
                -4.416681189774217015420887950711066328841194295133755225305844e-04,
                7.718952365964601416123598337617069164684563206275891099236221e-04,
                2.502464949920583984721024494943552146200854870661622211002418e-03,
                -4.970540926794084916072709193212250530229884674851059194676904e-03,
                -8.649031599946572670088689962363342931064457587276457635862837e-03,
                2.096272704497140779792663941456374769474253019820508756967019e-02,
                2.035485665853858604541136567848434116598037957308057353920592e-02,
                -7.047945564795552885905434147081164203757922879137146339823510e-02,
                -3.448140611368923447131875491841937617457159299006945091335206e-02,
                3.010998878403483951866118786441379902683440623823004392113350e-01,
                5.433431541205752976643226361323847389491208513427704619816300e-01,
                3.114106686884303879320332890564758567306967030720816157048784e-01,
                -4.108920994584877203854246950993119698209208008049962179892675e-02,
                -7.938037857340304740867638342147592451705918503253249849143539e-02,
                2.959417996664270964779250587338231669479158250990737014414477e-02,
                2.749324945396978289421721884832761949259069726774638450310483e-02,
                -1.622820901345195945858655272139343256940218447777075044002063e-02,
                -8.944948800734973559175903045029991278019908264185511730556261e-03,
                6.781924902353432370456282863377674743820538634665380239602198e-03,
                2.727776322637165251200756406544564359327985321401403409245472e-03,
                -2.173603470504406274543289770274934991733554729244606459300157e-03,
                -8.184301467772110627838702680469158860544118224504527036324346e-04,
                5.443695006423825218320707989235387077885356717678678221237514e-04,
                2.299669354496271337796680394777537358902688275513954507765924e-04,
                -1.093025858275705388257100771765109469841731265349469854748449e-04,
                -5.323102894235956524250869703703947941287269765076967124254140e-05,
                1.749138884456354646795465632327170008020712055425505484223307e-05,
                9.291277996211799255766657547295162218792966588358292566578482e-06,
                -2.067852860108562040355056354764683583070734740977224663511355e-06,
                -1.173528057754959701015486666538811237336231287996985858558749e-06,
                1.595231380068613024221709499993144713297922814623646799204434e-07,
                9.548236102970597211555688470325396069418862428946106509526618e-08,
                -6.001316648399794543233636397364817876191104394511939069108879e-09,
                -3.754092421718877429714314525761519021787631896344301745834088e-09,
            ]
            .as_slice(),
        }
    }
}

impl<T: Copy + 'static> WaveletFilterProvider<T> for CoifletFamily
where
    f64: AsPrimitive<T>,
{
    fn get_wavelet(&self) -> Cow<'_, [T]> {
        Cow::Owned(
            self.get_wavelet_impl()
                .iter()
                .map(|x| (x * std::f64::consts::SQRT_2).as_())
                .collect(),
        )
    }
}

#[cfg(test)]
mod tests {
    use super::*;
    use std::borrow::Cow;

    #[test]
    fn test_coiflets() {
        let to_test = [
            CoifletFamily::Coif1,
            CoifletFamily::Coif2,
            CoifletFamily::Coif3,
            CoifletFamily::Coif4,
            CoifletFamily::Coif5,
            CoifletFamily::Coif6,
        ];
        for b in to_test.iter() {
            let wv: Cow<[f64]> = b.get_wavelet();
            assert!(
                wv.len().is_multiple_of(2),
                "Assertion failed for coiflet {:?} with size {}",
                b,
                wv.len()
            );
        }
    }
}
